# Running Tests

This directory contains tests for the napari-ai-lab project.

## Test images

Test image can be found on dropbox [here](https://www.dropbox.com/scl/fo/j9hfhjauhkshy2008gcwr/AMsTTSmo_ac6v-JPtX_MqKs?rlkey=fqwerokq9o6o5cmoyv4ocdgqk&st=beam4kqo&dl=0).

## Setup

Before running tests, you need to activate the appropriate pixi environment:

```bash
# Navigate to the pixi environment directory
cd pixi/microsam_cellposesam_czi

# Start the pixi shell
pixi shell
```

## Running Tests

Once in the pixi shell, navigate back to the project root and run pytest:

```bash
# Return to project root
cd ../..

# Run all tests
pytest

# Run tests with print output visible
pytest -s

# Run tests and show skip reasons
pytest -rs

# Combine both options (show prints and skips)
pytest -s -rs

# Run specific test file
pytest tests/test_czi.py -s

# Run specific test function
pytest tests/test_czi.py::test_load_czi_file -s -rs

# Run tests with verbose output
pytest -v -s -rs
```

## Useful pytest Options

- `-s` : Show print statements in test output
- `-rs` : Show reasons for skipped tests
- `-v` : Verbose output (show individual test names)
- `-x` : Stop after first failure
- `--tb=short` : Shorter traceback format
- `-k "test_name"` : Run tests matching the given name pattern

## Test Data

Test images are located in `tests/test_images/` directory:
- `czi/` - CZI format test images
- `tif/` - TIFF format test images (some generated by tests)

**Note:** The `test_images/` directory is ignored by git (see `.gitignore`). You may need to provide your own test images or run tests that generate them.

## Common Issues

### Tests are Skipped

If tests are being skipped, it's usually because:
1. Test images are not present in `tests/test_images/`
2. Required packages are not installed (should not happen in pixi environment)

Use `pytest -rs` to see the specific reason for each skip.

### Import Errors

Make sure you're running from within the pixi shell environment. The environment includes all necessary dependencies like:
- `czifile`
- `tifffile`
- `ndevio`
- `pytest`
